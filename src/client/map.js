let map_data = [
[50,68,67,61,53,49,46,45,49,58,61,61,60,48,53,43,46,42,53,51,55,60,65,71,77,67,62,59,69,58,40,22,39,33,32,54,59,50,59,67],
[68,83,82,73,63,50,45,44,44,42,44,48,47,44,42,38,33,41,37,41,50,51,56,58,81,74,71,62,65,59,44,34,38,46,45,48,49,53,57,71],
[67,74,79,83,71,61,60,60,56,56,45,38,43,38,38,40,33,34,25,35,33,45,52,49,65,67,68,62,64,59,49,38,32,41,49,47,47,45,58,67],
[57,68,69,66,62,61,70,69,66,64,54,40,50,43,49,47,50,52,39,27,29,38,37,46,52,54,54,55,57,66,50,38,36,39,35,32,38,40,57,66],
[53,54,55,55,62,64,75,63,63,65,52,47,54,45,55,53,51,58,55,41,42,32,39,52,59,47,55,53,55,65,55,51,36,44,42,30,32,43,57,57],
[52,52,50,57,65,64,63,59,61,56,51,42,54,54,58,58,59,63,59,59,48,35,40,51,63,59,57,58,53,62,60,60,54,52,54,43,43,41,46,51],
[39,49,50,50,50,52,47,37,42,49,43,52,61,65,62,63,64,73,69,72,58,39,36,55,61,65,50,51,62,59,57,54,61,54,71,65,58,49,46,55],
[39,39,43,47,42,35,29,34,40,45,48,67,69,58,61,53,58,78,79,67,56,45,40,49,64,58,47,52,53,58,43,46,50,61,68,77,65,60,53,57],
[50,43,41,40,37,42,37,46,48,58,50,73,70,60,50,52,57,66,69,59,47,47,40,40,53,54,34,45,52,59,51,42,48,64,71,79,76,63,64,71],
[57,58,55,46,40,47,52,51,50,60,61,70,70,54,49,67,71,71,66,56,40,32,29,29,39,40,35,45,45,43,44,39,46,53,66,78,73,72,79,77],
[68,70,57,55,45,55,56,54,67,66,63,67,61,49,53,50,61,68,55,55,43,33,20,29,38,38,34,37,41,45,44,43,50,56,62,70,62,65,74,69],
[59,62,62,59,57,55,58,58,54,60,63,53,51,53,30,36,52,50,54,47,36,23,17,25,34,37,36,36,41,49,44,39,49,57,61,66,64,61,70,65],
[48,53,60,58,57,58,53,55,54,52,59,47,49,41,29,30,38,48,48,34,27,25,35,44,44,46,47,42,42,46,45,34,48,53,63,60,58,65,73,64],
[46,52,48,49,63,58,59,63,59,60,47,32,37,33,27,32,46,55,50,35,37,37,49,58,58,43,40,47,51,42,35,27,36,47,61,69,70,65,64,60],
[40,42,39,38,46,53,56,52,53,52,44,38,32,32,39,44,44,54,42,34,34,54,62,64,59,46,34,45,42,36,24,26,30,42,64,59,64,57,48,48],
[40,32,33,34,42,46,40,50,52,51,44,44,40,47,43,50,51,47,47,31,36,43,57,70,56,50,46,34,32,18,17,16,23,39,42,39,54,54,39,28],
[49,36,37,36,37,44,45,40,47,59,64,64,56,61,68,64,58,56,58,39,27,42,64,69,59,55,45,34,31,30,30,21,28,39,37,42,43,46,35,25],
[50,39,36,44,42,52,48,41,44,61,74,78,73,70,68,71,55,51,49,43,29,46,64,73,69,54,45,37,31,46,43,39,46,55,48,39,38,44,39,27],
[48,52,54,61,54,48,44,45,40,46,62,76,77,74,67,65,48,48,45,36,33,48,52,64,61,48,44,31,41,66,71,64,65,66,55,51,48,45,45,39],
[54,59,58,63,58,42,42,40,33,42,55,68,71,63,55,57,56,40,43,26,24,36,55,62,57,48,38,45,65,73,71,67,63,75,70,67,55,57,59,50],
[61,59,68,63,44,49,42,38,29,44,57,71,64,57,54,64,64,52,44,30,31,48,47,56,52,49,46,49,64,53,50,57,57,63,63,52,45,55,63,60],
[48,53,63,64,46,38,32,40,32,41,55,56,58,53,55,56,51,45,32,37,41,52,46,49,57,65,67,52,43,44,46,50,56,56,53,47,46,55,70,60],
[43,35,49,57,48,47,39,37,36,36,39,45,51,48,47,37,29,28,33,39,39,45,34,43,50,71,73,58,34,32,38,46,54,50,45,56,60,65,65,63],
[40,31,32,47,50,43,41,36,44,46,45,34,31,34,35,31,28,28,33,41,42,41,36,50,58,60,67,57,43,31,31,44,34,42,53,67,62,57,54,49],
[31,30,38,40,47,39,38,36,35,41,42,46,37,39,40,37,34,30,27,36,48,40,42,55,67,68,68,63,46,28,37,42,36,36,50,62,59,53,45,44],
[32,38,47,36,33,22,27,40,53,50,52,57,54,49,54,46,43,46,44,41,42,35,37,54,66,71,68,60,46,37,40,47,42,37,55,66,64,53,46,36],
[39,47,46,40,35,32,35,49,62,64,55,57,57,67,65,59,55,53,59,47,42,38,30,40,58,62,62,55,45,47,40,49,52,53,66,60,64,51,45,43],
[45,46,46,45,35,38,40,50,52,68,54,68,67,64,64,67,61,55,61,53,44,36,38,47,51,60,57,56,55,58,42,39,49,68,72,65,57,44,35,37],
[38,40,39,38,34,33,33,42,50,64,64,58,68,54,55,54,52,51,51,50,44,37,48,49,50,51,54,55,56,52,49,43,38,46,59,53,46,39,39,29],
[37,28,27,27,27,29,34,41,47,63,56,48,54,60,56,52,54,46,44,46,42,38,49,38,39,50,58,58,52,48,46,30,34,36,48,55,56,44,32,22],
[40,28,29,31,37,41,44,46,60,69,65,47,45,56,57,60,52,46,46,39,34,47,47,44,50,56,64,58,43,43,43,40,40,36,40,47,55,57,32,25],
[46,43,41,50,46,53,57,44,53,65,72,66,55,60,43,45,44,50,50,40,39,50,54,61,57,63,63,67,60,48,43,41,41,48,53,59,75,73,49,35],
[53,43,36,43,47,51,53,48,57,67,66,70,59,56,37,27,37,45,50,57,55,53,61,58,53,63,64,73,70,54,55,47,46,47,57,74,80,76,54,32],
[49,38,29,33,45,52,50,54,52,67,73,74,68,51,36,32,31,30,48,59,64,64,69,67,59,57,61,64,56,50,50,50,42,50,51,56,68,74,60,39],
[43,42,28,23,31,44,56,61,56,66,77,73,65,47,39,39,29,37,47,53,61,71,67,67,62,55,58,64,55,53,59,45,36,44,46,44,63,71,65,52],
[31,38,41,33,37,42,58,60,57,60,68,62,64,45,40,39,32,31,37,43,53,63,64,61,60,61,65,57,56,64,64,47,35,36,48,52,55,63,62,50],
[26,27,36,31,45,51,67,71,62,67,59,56,55,57,53,41,31,18,23,34,38,44,56,62,60,56,59,53,48,56,47,31,22,27,40,45,54,50,50,44],
[33,28,32,32,44,46,62,67,64,55,47,39,53,62,54,41,24,24,24,30,38,41,56,61,60,61,56,46,39,42,47,27,27,27,25,32,47,50,29,34],
[31,30,38,31,36,40,54,60,55,36,41,42,55,62,56,46,35,30,35,40,40,53,50,55,53,44,39,33,28,34,38,43,43,38,25,26,48,49,26,25],
[46,41,38,39,44,51,54,45,31,29,44,50,62,63,58,53,43,41,50,50,53,61,54,47,52,43,48,33,31,37,48,68,70,66,48,34,41,31,27,21],
  ];

export function map() {
  // clear edges
  let data = map_data.map(function (row, ridx) {
    return row.map(function (v, idx) {
      if (idx === 0 || idx === row.length-1) {
        return false;
      }
      if (ridx === 0 || ridx === map_data.length - 1) {
        return false;
      }
      return v > 58 ? 'land' : null;
    });
  });
  // no tiny islands
  let island_size = data.map(function () {
    return [];
  });
  function count(x, y) {
    let search = [[x,y]];
    let done = [];
    while (search.length) {
      let s = search.pop();
      x = s[0];
      y = s[1];
      if (island_size[x][y]) {
        continue;
      }
      if (!data[x][y]) {
        continue;
      }
      island_size[x][y] = -1;
      done.push(s);
      search.push([x+1,y]);
      search.push([x-1,y]);
      search.push([x,y+1]);
      search.push([x,y-1]);
    }
    let r = done.length;
    for (let ii = 0; ii < done.length; ++ii) {
      island_size[done[ii][0]][done[ii][1]] = r;
    }
    return r;
  }
  function fill(x, y, v) {
    let match = data[x][y];
    let search = [[x,y]];
    while (search.length) {
      let s = search.pop();
      x = s[0];
      y = s[1];
      if (data[x][y] !== match) {
        continue;
      }
      data[x][y] = v;
      search.push([x+1,y]);
      search.push([x-1,y]);
      search.push([x,y+1]);
      search.push([x,y-1]);
    }
  }
  for (let ii = 1; ii < data.length - 1 ; ++ii) {
    for (let jj = 1; jj < data[ii].length - 1; ++jj) {
      if (data[ii][jj]) {
        if (!island_size[ii][jj]) {
          let c = count(ii, jj);
          if (c <= 5) {
            fill(ii, jj, null);
          }
        }
      }
    }
  }

  // no diagnols
  for (let ii = 1; ii < data.length - 1 ; ++ii) {
    for (let jj = 1; jj < data[ii].length - 1; ++jj) {
      if (data[ii][jj] && data[ii+1][jj+1] &&
        !data[ii+1][jj] && !data[ii][jj+1]) {
        data[ii+1][jj] = 'land';
      }
      if (data[ii+1][jj] && data[ii][jj+1] &&
        !data[ii][jj] && !data[ii+1][jj+1]) {
        data[ii+1][jj+1] = 'land';
      }
    }
  }

  // place ports
  [
    [4,3],
    [16,12],
    [9,13],
    [19,2],
    [27,10],
    [3,28],
    [9,33],
    [15,22],
    [26,33],
  ].forEach(function (p) {
    data[p[0]][p[1]] = 'port';
  });

  return data;
}
